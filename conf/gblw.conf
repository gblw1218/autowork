[General]
bypass-system = true
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, *.lan, *.internal, captive.apple.com, *.apple.com, *.icloud.com, *.abchina.com.cn, *.ccb.com, *.psbc.com, *.boc.cn, *.icbc.com.cn, *.cmbchina.com, *.alipay.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32
dns-server = h3://dns.alidns.com/dns-query, https://doh.pub/dns-query, https://dns.alidns.com/dns-query, quic://223.5.5.5, tls://223.5.5.5
# 当解析国外网站或主 DNS 遭到污染时，小火箭会启用这些服务器
fallback-dns-server = https://1.1.1.1/dns-query, https://8.8.8.8/dns-query
private-ip-answer = true
dns-direct-fallback-proxy = true
dns-direct-system = false
all-hybrid = true
ipv6 = false
prefer-ipv6 = false
icmp-auto-reply = true
always-reject-url-rewrite = false
tun-included-routes = 
always-real-ip = 
hijack-dns = 8.8.8.8:53,8.8.4.4:53
udp-policy-not-supported-behaviour = DIRECT
include = 
# stun-response-ip =
# stun-response-ipv6 =
# 网络兼容模式。当参数的值设定为3时的效果等同于：设置 - 代理 - 代理类型 - None。
# compatibility-mode =
# always-ip-address =
[Proxy]
# 代理分组类型：
# select:手动切换节点。
# url-test:自动切换延迟最低节点。
# fallback:节点挂掉时自动切换其他可用节点。
# load-balance:不同规则的请求使用分组里的不同节点进行连接。
# random:随机使用分组里的不同节点进行连接。
# ----------
# policy-regex-filter表示正则式或关键词筛选，常用写法：
# 保留节点名称含有关键词A和B的节点:
# (?=.*(A))^(?=.*(B))^.*$
# 保留节点名称含有关键词A或B的节点:
# A|B
# 排除节点名称含有关键词A或B的节点:
# ^((?!(A|B)).)*$
# ----------
# 代理分组其他设置参数：
# interval:指定间隔多长时间后需要重新发起测试。
# timeout:如果测试在超时前未完成，放弃测试。
# tolerance:只有当新优胜者的分数高于旧优胜者的分数加上公差时，才会进行线路更换。
# url:指定要测试的URL。
# ----------
# 不含正则筛选的代理分组，示例：
# 名称=类型(如select,url-test,fallback,load-balance,random),策略(如direct,proxy,订阅名称,代理分组,节点),interval=测试周期,timeout=超时时间,tolerance=公差,policy-select-name=指定选择的节点备注名称,select=默认策略(0表示第一个策略,1表示第二个策略,2表示第三个策略……),url=测试地址
# 含正则筛选的代理分组，示例：
# 名称=类型(如select,url-test,fallback,load-balance,random),policy-regex-filter=正则式或关键词筛选,interval=测试周期,timeout=超时时间,tolerance=公差,policy-select-name=指定选择的节点备注名称,select=默认策略(0表示第一个策略,1表示第二个策略,2表示第三个策略……),url=测试地址
# 开启订阅筛选的代理分组，示例：
# 名称=类型(如select,url-test,fallback,load-balance,random),订阅名称(多个订阅时,用逗号分隔),use=true,policy-regex-filter=正则式或关键词筛选(省略该参数时,表示匹配对应订阅的全部节点),interval=测试周期,timeout=超时时间,tolerance=公差,policy-select-name=指定选择的节点备注名称,select=默认策略(0表示第一个策略,1表示第二个策略,2表示第三个策略……),url=测试地址
# ----------
[Proxy Group]
AutoBoost = url-test,url=http://www.gstatic.com/generate_204,interval=2400,tolerance=80,timeout=3,policy-regex-filter=^((?!(CN|中国)).)*$
Sport1 = fallback,url=http://www.gstatic.com/generate_204,interval=1200,tolerance=80,timeout=2,policy-regex-filter=港澳台|新加坡|日本|韩国|以色列|阿联酋|芬兰|泰国|越南
Sport2 = fallback,url=http://www.gstatic.com/generate_204,interval=1800,tolerance=80,timeout=3,policy-regex-filter=美国|加拿大|澳大利亚|冰岛|爱尔兰|智利|德国|英国|意大利|荷兰|瑞士|法国|丹麦|挪威|卡塔尔
AIService = fallback,url=http://www.gstatic.com/generate_204,interval=1200,tolerance=80,timeout=2,policy-regex-filter=美国|加拿大|澳大利亚|德国|英国|荷兰|法国|新加坡|日本
[Rule]
# ==================== 拦截层 ====================
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Advertising/Advertising_Domain.list,REJECT
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/AdGuardSDNSFilter/AdGuardSDNSFilter_Domain.list,REJECT
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Privacy/Privacy_Domain.list,REJECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Privacy/Privacy.list,REJECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Advertising/Advertising.list,REJECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Hijacking/Hijacking.list,REJECT
DOMAIN-SET,https://raw.githubusercontent.com/gblw1218/autowork/refs/heads/main/rule/reject.list,REJECT
# ==================== AI层 ====================
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Gemini/Gemini.list,AIService
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/OpenAI/OpenAI.list,AIService
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Copilot/Copilot.list,AIService
# ==================== 直连层 ====================
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Lan/Lan.list,DIRECT
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/China/China_Domain.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/China/China.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Apple/Apple_Domain.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/AppleDev/AppleDev.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/gblw1218/autowork/refs/heads/main/rule/apple.list,DIRECT

# ==================== 代理层 ====================
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Proxy/Proxy.list,PROXY
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Proxy/Proxy_Domain.list,PROXY

# ==================== 兜底策略 ====================
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Global/Global_Domain.list,AutoBoost
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Global/Global.list,AutoBoost
GEOIP,CN,DIRECT
FINAL,AutoBoost,dns-failed
[Script]

[Host]
# --- 系统与认证 ---
*.apple.com = server:system
*.icloud.com = server:system
captive.apple.com = server:system
localhost = 127.0.0.1
#阿里系
*.alibaba.com = server:dns.alidns.com
*.alicdn.com = server:dns.alidns.com
*.alipay.com = server:dns.alidns.com
*.taobao.com = server:dns.alidns.com
*.tmall.com = server:dns.alidns.com
*.amap.com = server:dns.alidns.com
#腾讯系
*.qq.com = server:doh.pub
*.tencent.com = server:doh.pub
*.tenpay.com = server:doh.pub
*.weixin.com = server:doh.pub
*.wechat.com = server:doh.pub
*.servicewechat.com = server:doh.pub
# 微信图片与静态资源 CDN
*.gtimg.cn = server:doh.pub
*.gtimg.com = server:doh.pub

[URL Rewrite]
# Google搜索引擎防跳转的重写。
^https?://(www.)?g.cn https://www.google.com 302
^https?://(www.)?google.cn https://www.google.com 302
(^https?:\/\/[\w-]+\.googlevideo\.com\/(?!dclk_video_ads).+?)&ctier=L(&.+?),ctier,(.+) $1$2$3 302
^https?:\/\/[\w-]+\.googlevideo\.com\/(?!(dclk_video_ads|videoplayback\?)).+&oad - reject

[MITM]
